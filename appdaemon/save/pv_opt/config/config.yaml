# Internal configuration --- DO NOT EDIT ---
pvpy:
  module: pvpy
  global: true

inverters:
  module: inverters
  global: true

pv_opt:
  module: pv_opt
  class: PVOpt
  dependencies:
    - pvpy
    - solis

  log: pv_opt_log
  prefix: pvopt
  debug: false


# User configuration ---  EDIT AWAY! ---

  # If true the current config in HA will be over-written with that in the config.yaml. 
  overwrite_ha_on_restart: false
  list_entities: true

  # If true the personal data will be redacted from the log files.
  redact_personal_data_from_log: true

  #=======================================
  #Logging Category Control
  #=======================================
  #Defines Logging subjects to add to logfile
  #Ignored if "debug" is set to False above
  #
  # S = Startup/Initialisation Logging
  # T = Tariff loading Logging
  # P = Power consumption history Logging
  # C = Charge algorithm Logging
  # D = Discharge algorithm Logging
  # W = Charge/Discharge Windows Logging
  # F = Power Flows Logging
  # V = Power Flows debugging (extra verbose)
  # I = inverter control/commands Logging
  # E = EV debugging

  # Letters can be added to "debug_categories" in any order

  debug_categories: CDFW

  # ========================================
  # Basic parameters
  # ========================================
  forced_charge: true
  forced_discharge: true
  allow_cyclic: false
  read_only: true
  include_export: true

  pass_threshold_p: 1

  # ========================================
  # Plant parameters
  # ========================================

  # All parameters can be a number or point to an entity UNLESS they start with 'id_'. All of
  # these are required but will be defaulted if not specified

  battery_capacity_wh: 9600
  # inverter_efficiency_percent: 97 # Default: 97
  # charger_efficiency_percent: 97 # Default: 91
  # maximum_dod_percent: 15
  charger_power_watts: 5000
  inverter_power_watts: 6000
  battery_current_limit_amps: 80
  # inverter_loss_watts: 100
  
  # ========================================
  # Solcast configuration
  # ========================================
  # use_solar: true
  #
  # id_solcast_today: sensor.solcast_pv_forecast_forecast_today
  # id_solcast_tomorrow: sensor.solcast_pv_forecast_forecast_tomorrow
  # solar_confidence_level: 50
  
  # ========================================
  # Consumption forecast parameters
  # ========================================
  #
  
  # use_consumption_history: true
  consumption_history_days: 7
  day_of_week_weighting: 0
  consumption_margin: 25

  daily_consumption_kwh: 35
  # shape_consumption_profile: true
  # consumption_shape:
  #   - hour: 0
  #     consumption: 300
  #   - hour: 0.5
  #     consumption: 200
  #   - hour: 6
  #     consumption: 150
  #   - hour: 8
  #     consumption: 500
  #   - hour: 15.5
  #     consumption: 500
  #   - hour: 17
  #     consumption: 750
  #   - hour: 22
  #     consumption: 750
  #   - hour: 24
  #     consumption: 300
  

  # ========================================
  # Octopus account parameters
  # ========================================

  # octopus_auto: True # Read tariffs from the Octopus Energy integration. If successful this over-rides the following parameters

  # octopus_account: !secret octopus_account
  # octopus_api_key: !secret octopus_api_key

  # The following Can be omitted if either of the above options is working correctly:

  octopus_import_tariff_code: E-1R-INTELLI-VAR-22-10-14-F
  octopus_export_tariff_code: E-1R-OUTGOING-FIX-12M-19-05-13-F

  # octopus_import_tariff_code: E-2R-VAR-22-11-01-G
  # octopus_export_tariff_code: E-1R-AGILE-OUTGOING-19-05-13-F

  # octopus_import_tariff_code: E-1R-AGILE-23-12-06-F
  # octopus_export_tariff_code: E-1R-OUTGOING-FIX-12M-19-05-13-F
  # octopus_export_tariff_code: E-1R-AGILE-OUTGOING-19-05-13-F

  # octopus_import_tariff_code: E-1R-FLUX-IMPORT-23-02-14-G
  # octopus_export_tariff_code: E-1R-FLUX-EXPORT-23-02-14-G
  
  # ========================================
  # EV parameters
  # ========================================
  #
  # If you have a Zappi Charger, uncomment next line to allow Pv_opt to detect car plugin status
  # for use with the Octopus Intelligent Tariff and to allow EV consumption data to be read (if needed). 
  #
  ev_charger: Zappi   # Default = None
  #
  # By default, Zappi is set to seen as part of the house load to prevent house battery discharge during car charging and allow discounting of EV consumption
  # from house charging calculations. 
  #
  # If your Zappi is not seen as part of the house load, uncomment next line to set to False. 
  #
  # ev_part_of_house_load = False     # Default = True
                                                           
  ev_charger_power_watts: 7300 #  default 7000             
  ev_battery_capacity_kwh: 63                                                          

  # ===============================================================================================================
  # Brand / Integration Specific Config: SOLIS_SOLAX_MODBUS: https://github.com/wills106/homeassistant-solax-modbus
  # ===============================================================================================================
  #
  # These are the default entities used with the Solis Solax Modbus integration. You can change them here and over-ride the defaults

  inverter_type: "SOLIS_SOLAX_MODBUS"
  device_name: solax

  # battery_voltage: sensor.{device_name}_battery_voltage
  # update_cycle_seconds: 15
  # maximum_dod_percent: number.{device_name}_battery_minimum_soc 
  
  id_consumption_today: sensor.{device_name}_consumption_today
  id_consumption:
    - sensor.{device_name}_house_load
    - sensor.{device_name}_bypass_load
 
  # id_grid_import_today: sensor.{device_name}_grid_import_today
  # id_grid_export_today: sensor.{device_name}_grid_export_today

  # sleep_soc: 0
  # id_battery_soc: sensor.{device_name}_battery_soc
  # id_timed_charge_start_hours: number.{device_name}_timed_charge_start_hours
  # id_timed_charge_start_minutes: number.{device_name}_timed_charge_start_minutes
  # id_timed_charge_end_hours: number.{device_name}_timed_charge_end_hours
  # id_timed_charge_end_minutes: number.{device_name}_timed_charge_end_minutes
  # id_timed_charge_current: number.{device_name}_timed_charge_current

  # id_timed_discharge_start_hours: number.{device_name}_timed_discharge_start_hours
  # id_timed_discharge_start_minutes: number.{device_name}_timed_discharge_start_minutes
  # id_timed_discharge_end_hours: number.{device_name}_timed_discharge_end_hours
  # id_timed_discharge_end_minutes: number.{device_name}_timed_discharge_end_minutes
  # id_timed_discharge_current: number.{device_name}_timed_discharge_current

  # id_timed_charge_discharge_button: button.{device_name}_update_charge_discharge_times
  # id_inverter_mode: select.{device_name}_energy_storage_control_switch

  # ==============================================================================================================
  # Brand / Integration Specific Config: SOLIS_CORE_MODBUS: https://github.com/fboundy/ha_solis_modbus
  # ==============================================================================================================
  #
  # These are the default entities used with the Solis Core Modbus integration. You can change them here and over-ride the defaults

  # modbus_hub: "{device_name}"
  # modbus_slave: 1
  # battery_voltage: sensor.{device_name}_battery_voltage
  # maximum_dod_percent: sensor.{device_name}_overdischarge_soc
  # update_cycle_seconds: 60
  # id_consumption_today: sensor.{device_name}_daily_consumption

  # id_grid_power: sensor.{device_name}_grid_active_power
  # id_inverter_ac_power: sensor.{device_name}_inverter_ac_power
  # id_battery_soc: sensor.{device_name}_battery_soc

  # id_timed_charge_start_hours: sensor.{device_name}_timed_charge_start_hour
  # id_timed_charge_start_minutes: sensor.{device_name}_timed_charge_start_minute
  # id_timed_charge_end_hours: sensor.{device_name}_timed_charge_end_hour
  # id_timed_charge_end_minutes: sensor.{device_name}_timed_charge_end_minute
  # id_timed_charge_current: sensor.{device_name}_timed_charge_current_limit

  # id_timed_discharge_start_hours: sensor.{device_name}_timed_discharge_start_hour
  # id_timed_discharge_start_minutes: sensor.{device_name}_timed_discharge_start_minute
  # id_timed_discharge_end_hours: sensor.{device_name}_timed_discharge_end_hour
  # id_timed_discharge_end_minutes: sensor.{device_name}_timed_discharge_end_minute
  # id_timed_discharge_current: sensor.{device_name}_timed_discharge_current_limit
  # id_inverter_mode: sensor.{device_name}_energy_storage_control_switch

  # ==============================================================================================================
  # Brand / Integration Specific Config: SOLIS_SOLARMAN: https://github.com/StephanJoubert/home_assistant_solarman
  # ==============================================================================================================
  #
  # These are the default entities used with the Solis Solarman integration. You can change them here and over-ride the defaults

  # battery_voltage: sensor.{device_name}_battery_voltage
  # maximum_dod_percent: 15
  # update_cycle_seconds: 60
  
  # id_consumption_today: sensor.{device_name}_daily_house_backup_consumption

  # id_grid_power: sensor.{device_name}_meter_active_power
  # id_inverter_ac_power": sensor.{device_name}_inverter_ac_power
  # id_battery_soc: sensor.{device_name}_battery_soc
  # id_backup_mode_soc: 

  # id_timed_charge_start_hours: sensor.{device_name}_timed_charge_start_hour
  # id_timed_charge_start_minutes: sensor.{device_name}_timed_charge_start_minute
  # id_timed_charge_end_hours: sensor.{device_name}_timed_charge_end_hour
  # id_timed_charge_end_minutes: sensor.{device_name}_timed_charge_end_minute
  # id_timed_charge_current: sensor.{device_name}_timed_charge_current

  # id_timed_discharge_start_hours: sensor.{device_name}_timed_discharge_start_hour
  # id_timed_discharge_start_minutes: sensor.{device_name}_timed_discharge_start_minute
  # id_timed_discharge_end_hours: sensor.{device_name}_timed_discharge_end_hour
  # id_timed_discharge_end_minutes: sensor.{device_name}_timed_discharge_end_minute
  # id_timed_discharge_current: sensor.{device_name}_timed_discharge_current

  # id_inverter_mode: sensor.{device_name}_storage_control_mode


# Tariff comparison
  id_daily_solar: sensor.{device_name}_power_generation_today
  id_solar_power: sensor.{device_name}_pv_total_power
  alt_tariffs:
  #   - name: Eco7_Agile
  #     octopus_import_tariff_code: E-2R-VAR-22-11-01-G
  #     octopus_export_tariff_code: E-1R-AGILE-OUTGOING-19-05-13-G
    - name: Flux
      octopus_import_tariff_code: E-1R-FLUX-IMPORT-23-02-14-F
      octopus_export_tariff_code: E-1R-FLUX-EXPORT-23-02-14-F
    - name: Agile_Fix
      octopus_import_tariff_code: E-1R-AGILE-23-12-06-F
      octopus_export_tariff_code: E-1R-OUTGOING-FIX-12M-19-05-13-F
